tinymce.PluginManager.requireLangPack("codemirror");
tinymce.PluginManager.add("codemirror", function (e, o) {
    function t() {
        e.focus();
        e.selection.collapse(true);
        if (typeof e.settings.codemirror == 'undefined') e.settings.codemirror = {};
        if (e.settings.codemirror.saveCursorPosition) {
            e.selection.setContent('<span style="display: none;" class="CmCaReT">&#x0;</span>')
        }
        var t = 800;
        if (e.settings.codemirror.width) {
            t = e.settings.codemirror.width
        }
        var r = 550;
        if (e.settings.codemirror.width) {
            r = e.settings.codemirror.height
        }
        var i = tinymce.majorVersion < 5 ? [{
                    text: "Ok",
                    subtype: "primary",
                    onclick: function () {
                        var e = document.querySelectorAll(".mce-container-body>iframe")[0];
                        e.contentWindow.submit();
                        n.close()
                    }
                }, {
                    text: "Cancel",
                    onclick: "close"
                }
            ] : [{
                    type: "custom",
                    text: "Ok",
                    name: "codemirrorOk",
                    primary: true
                }, {
                    type: "cancel",
                    text: "Cancel",
                    name: "codemirrorCancel"
                }
            ];
        var c = {
            title: "HTML source code",
            url: o + "/source.html",
            width: t,
            height: r,
            resizable: true,
            maximizable: true,
            fullScreen: e.settings.codemirror.fullscreen,
            saveCursorPosition: false,
            buttons: i
        };
        if (tinymce.majorVersion >= 5) {
            c.onAction = function (e, o) {
                if (o.name === "codemirrorOk") {
                    var t = document.querySelectorAll(".tox-dialog__body-iframe iframe")[0];
                    t.contentWindow.submit();
                    n.close()
                }
            }
        }
        var n = tinymce.majorVersion < 5 ? e.windowManager.open(c) : e.windowManager.openUrl(c);
        if (e.settings.codemirror.fullscreen) {
            n.fullscreen(true)
        }
    }
    if (tinymce.majorVersion < 5) {
        e.addButton("code", {
            title: "Source code",
            icon: "code",
            onclick: t
        });
        e.addMenuItem("code", {
            icon: "code",
            text: "Source code",
            context: "tools",
            onclick: t
        })
    } else {
        e.ui.registry.addButton("code", {
            icon: "sourcecode",
            title: "Source code",
            tooltip: "Source code",
            onAction: t
        });
        e.ui.registry.addMenuItem("code", {
            icon: "sourcecode",
            text: "Source code",
            onAction: t,
            context: "tools"
        })
    }
});
